<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotof√°cil - An√°lise de Concursos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='script.js') }}" defer></script>
</head>

<body>
    <div class="container">
        <header>
            <h1>üé∞ Lotof√°cil - An√°lise de Concursos</h1>
            <div class="header-info">
                <span class="info-badge">Total de Concursos: {{ total_concursos }}</span>
                <span class="info-badge">Ciclo Atual: {{ ciclo_atual }}</span>
                <a href="{{ url_for('atualizar_banco') }}" class="btn-atualizar">üîÑ Atualizar Banco de Dados</a>
            </div>
        </header>

        <!-- Barra de Navega√ß√£o Fixa -->
        <nav class="sticky-nav">
            <a href="#concursos" class="nav-link">üìä Concursos</a>
            <a href="#analise" class="nav-link">üìà An√°lise</a>
            <a href="#mapa-calor" class="nav-link">üî• Mapa de Calor</a>
            <a href="#sugestoes" class="nav-link">üé≤ Sugest√µes</a>
        </nav>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <!-- Se√ß√£o 1: √öltimos Concursos em Cards -->
        <div id="concursos" class="concursos-section">
            <div class="section-header">
                <h2>üìä √öltimos Concursos</h2>
                <div class="limit-selector-wrapper">
                    <label for="limit-selector">Exibir:</label>
                    <select id="limit-selector" onchange="updateLimit()">
                        <option value="5">5 jogos</option>
                        <option value="10">10 jogos</option>
                        <option value="15" {% if limit==15 %}selected{% endif %}>15 jogos</option>
                        <option value="20">20 jogos</option>
                        <option value="25">25 jogos</option>
                    </select>
                </div>
            </div>

            <div class="concursos-grid">
                {% for concurso in concursos %}
                <div class="concurso-card">
                    <div class="concurso-card-header">
                        <h3>Concurso {{ concurso.concurso }}</h3>
                        <span class="concurso-date">{{ concurso.data }}</span>
                    </div>

                    <!-- Grade 5x5 -->
                    <div class="concurso-cartela">
                        <div class="cartela-grid">
                            {% for i in range(1, 26) %}
                            <div class="cartela-cell {% if i in concurso.numeros %}selected{% endif %} {% if i in concurso.novos_set %}is-new-in-cycle{% endif %}"
                                title="{% if i in concurso.novos_set %}Novo no Ciclo{% endif %}">
                                {{ i }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- N√∫meros em lista -->
                    <div class="concurso-numbers">
                        {% for numero in concurso.numeros %}
                        <span class="numero-badge-small">{{ numero }}</span>
                        {% endfor %}
                    </div>

                    <!-- Estat√≠sticas -->
                    <div class="concurso-stats">
                        <div class="stat-row">
                            <span class="stat-label">üîÑ Ciclo:</span>
                            <span class="stat-value ciclo-badge">{{ concurso.ciclo }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">‚ú® Novos/Rep:</span>
                            <span class="stat-value"
                                title="{{ concurso.novos_ciclo }} novos no ciclo, {{ concurso.repetidos_ciclo }} repetidos">
                                <span style="color: #10b981;">{{ concurso.novos_ciclo }}</span> /
                                <span style="color: #6b7280;">{{ concurso.repetidos_ciclo }}</span>
                            </span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">‚öñÔ∏è P-I-NP:</span>
                            <span class="stat-value">{{ concurso.config_pip }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">üî≤ Moldura:</span>
                            <span class="stat-value">{{ concurso.moldura }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">‚¨õ Miolo:</span>
                            <span class="stat-value">{{ concurso.miolo }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">üìä Linhas:</span>
                            <span class="stat-value">{{ concurso.distribuicao_linhas }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">‚ó∞ Q1:</span>
                            <span class="stat-value">{{ concurso.q1 }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">‚ó≥ Q2:</span>
                            <span class="stat-value">{{ concurso.q2 }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">‚úü Cruz:</span>
                            <span class="stat-value">{{ concurso.cruz }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">‚ó± Q3:</span>
                            <span class="stat-value">{{ concurso.q3 }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">‚ó≤ Q4:</span>
                            <span class="stat-value">{{ concurso.q4 }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Se√ß√£o 2: An√°lise Estat√≠stica -->
        <div id="analise" class="analysis-section">
            <h2>üìà An√°lise Estat√≠stica</h2>

            <div class="analysis-grid">
                <!-- Status dos 25 N√∫meros -->
                <div class="analysis-card">
                    <h3>üî¢ Status dos N√∫meros</h3>
                    <div class="table-wrapper">
                        <table class="numeros-table">
                            <thead>
                                <tr>
                                    <th>N¬∫</th>
                                    <th>Freq.</th>
                                    <th>%</th>
                                    <th>No Ciclo?</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for num_info in numeros_info %}
                                <tr>
                                    <td class="numero-col">
                                        <span class="numero-badge-small">{{ num_info.numero }}</span>
                                    </td>
                                    <td class="freq-col">{{ num_info.frequencia }}</td>
                                    <td class="percent-col">{{ num_info.percentual }}%</td>
                                    <td class="status-col">
                                        {% if num_info.no_ciclo %}
                                        <span class="status-badge status-sim">Sim</span>
                                        {% else %}
                                        <span class="status-badge status-nao">N√£o</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- An√°lise Geogr√°fica Consolidada -->
                <div class="analysis-card">
                    <h3>üó∫Ô∏è An√°lise Geogr√°fica</h3>

                    <!-- Diagramas Explicativos -->
                    <h4 class="subsection-title">Guia Visual</h4>
                    <div class="diagrams-container">
                        <div class="diagram-item">
                            <img src="/static/moldura_miolo_diagram.png" alt="Diagrama Moldura vs Miolo"
                                class="diagram-image">
                            <p class="diagram-caption">Moldura (bordas) vs Miolo (centro)</p>
                        </div>
                        <div class="diagram-item">
                            <img src="/static/quadrantes_cruz_diagram.png" alt="Diagrama Quadrantes e Cruz"
                                class="diagram-image">
                            <p class="diagram-caption">Quadrantes (Q1-Q4) e Cruz (‚úü)</p>
                        </div>
                    </div>

                    <!-- Linhas -->
                    <h4 class="subsection-title">Distribui√ß√£o por Linhas</h4>
                    <div class="table-wrapper">
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>Linha</th>
                                    <th>Total</th>
                                    <th>%</th>
                                    <th>M√©dia</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for linha in consolidated_geo.linhas %}
                                <tr>
                                    <td>L{{ linha.linha }} ({{ linha.range }})</td>
                                    <td>{{ linha.total }}</td>
                                    <td>{{ linha.percentual }}%</td>
                                    <td>{{ linha.media_por_jogo }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Padr√µes Mais Comuns -->
                    <div class="top-distributions">
                        <h4>Padr√µes Mais Comuns:</h4>
                        {% for dist, count in consolidated_geo.distribuicoes_linhas_comuns %}
                        <div class="dist-item">
                            <span class="dist-pattern">{{ dist }}</span>
                            <span class="dist-count">{{ count }}x</span>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Moldura/Miolo -->
                    <h4 class="subsection-title">Moldura vs Miolo</h4>
                    <div class="table-wrapper">
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>Regi√£o</th>
                                    <th>Total</th>
                                    <th>%</th>
                                    <th>M√©dia</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Moldura</td>
                                    <td>{{ consolidated_geo.moldura.total }}</td>
                                    <td>{{ consolidated_geo.moldura.percentual }}%</td>
                                    <td>{{ consolidated_geo.moldura.media_por_jogo }}</td>
                                </tr>
                                <tr>
                                    <td>Miolo</td>
                                    <td>{{ consolidated_geo.miolo.total }}</td>
                                    <td>{{ consolidated_geo.miolo.percentual }}%</td>
                                    <td>{{ consolidated_geo.miolo.media_por_jogo }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- An√°lise de Quadrantes e Cruz -->
                    <h4 class="subsection-title">Quadrantes e Cruz</h4>
                    <div class="quadrantes-compact">
                        <div class="quadrante-mini">
                            <strong>Q1:</strong> {{ heat_map.quadrantes.quadrante1.percentual }}%
                        </div>
                        <div class="quadrante-mini">
                            <strong>Q2:</strong> {{ heat_map.quadrantes.quadrante2.percentual }}%
                        </div>
                        <div class="quadrante-mini cruz-mini">
                            <strong>‚úü:</strong> {{ heat_map.quadrantes.cruz.percentual }}%
                        </div>
                        <div class="quadrante-mini">
                            <strong>Q3:</strong> {{ heat_map.quadrantes.quadrante3.percentual }}%
                        </div>
                        <div class="quadrante-mini">
                            <strong>Q4:</strong> {{ heat_map.quadrantes.quadrante4.percentual }}%
                        </div>
                    </div>
                </div>

                <!-- An√°lise de Ciclos -->
                <div class="analysis-card">
                    <h3>üîÑ An√°lise de Ciclos</h3>

                    <!-- Padr√µes de Sa√≠da -->
                    <h4 class="subsection-title">Padr√µes de Sa√≠da Mais Comuns</h4>
                    <p class="chart-desc">Ordem em que os n√∫meros fecham o ciclo (ex: 15-5-3-2 significa 15 no 1¬∫, 5 no
                        2¬∫, etc)</p>
                    <div class="table-wrapper">
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>Padr√£o</th>
                                    <th>Frequ√™ncia</th>
                                    <th>%</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for pattern in cycle_patterns %}
                                <tr>
                                    <td class="pattern-cell">{{ pattern.Padrao }}</td>
                                    <td>{{ pattern.Frequencia }}</td>
                                    <td>{{ "%.2f"|format(pattern.Percentual) }}%</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <h3>‚öñÔ∏è Pares-√çmpares-Primos</h3>
                    <div class="table-wrapper">
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>Configura√ß√£o</th>
                                    <th>Frequ√™ncia</th>
                                    <th>%</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in global_pip_dist.distribuicao[:10] %}
                                <tr>
                                    <td class="config-cell">{{ item.config }}</td>
                                    <td>{{ item.frequencia }}</td>
                                    <td>{{ item.percentual }}%</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- An√°lise P-I-NP -->
                <div class="analysis-card">
                    <!-- Distribui√ß√£o de Novos N√∫meros -->
                    <h4 class="subsection-title">Novos N√∫meros por Sorteio do Ciclo</h4>
                    <p class="chart-desc">Probabilidade de quantos n√∫meros novos vir√£o no pr√≥ximo sorteio</p>

                    <div class="cycle-steps-container">
                        {% for step in dist_novos_display %}
                        <div class="step-card">
                            <h5 class="step-title">{{ step.passo }}¬∫ Sorteio do Ciclo</h5>
                            <div class="mini-table-wrapper">
                                <table class="mini-stats-table">
                                    <thead>
                                        <tr>
                                            <th>Novos</th>
                                            <th>%</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in step.dados[:5] %}
                                        <tr>
                                            <td><strong>{{ row.Qtd_Novos }}</strong></td>
                                            <td>{{ "%.1f"|format(row.Percentual) }}%</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- An√°lise de Frequ√™ncia por Rodada -->
                <div class="analysis-card full-width-card">
                    <h3>üìä Frequ√™ncia por Rodada do Ciclo</h3>
                    <p class="chart-desc">N√∫meros que mais saem na 1¬™, 2¬™, 3¬™ e 4¬™ rodada do ciclo</p>

                    <div class="freq-steps-container">
                        {% for step_data in freq_by_step_display %}
                        <div class="step-column">
                            <h4 class="step-header">{{ step_data.step }}¬™ Rodada</h4>
                            <div class="table-wrapper">
                                <table class="mini-stats-table">
                                    <thead>
                                        <tr>
                                            <th>N¬∫</th>
                                            <th>Freq.</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in step_data.dados %}
                                        <tr>
                                            <td class="number-cell-bold">{{ row.Numero }}</td>
                                            <td>{{ "%.1f"|format(row.Percentual) }}%</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>

        <!-- Se√ß√£o 3: Mapa de Calor -->
        <div id="mapa-calor" class="heatmap-section">
            <h2>üî• Mapa de Calor</h2>
            <p class="section-subtitle">Visualiza√ß√£o da frequ√™ncia de cada n√∫mero na cartela</p>

            <div class="heatmap-container">
                <!-- Mapa de Calor 5x5 -->
                <div class="heatmap-grid">
                    {% for item in heat_map.heat_map %}
                    <div class="heatmap-cell" style="background: linear-gradient(135deg, 
                        rgba(239, 68, 68, {{ item.intensidade / 100 }}) 0%, 
                        rgba(220, 38, 38, {{ item.intensidade / 100 }}) 100%);">
                        <span class="heatmap-number">{{ item.numero }}</span>
                        <span class="heatmap-freq">{{ item.frequencia }}</span>
                        <span class="heatmap-percent">{{ item.percentual }}%</span>
                    </div>
                    {% endfor %}
                </div>
                <div class="heatmap-legend">
                    <span>Menos Frequente ({{ heat_map.min_freq }})</span>
                    <div class="legend-gradient"></div>
                    <span>Mais Frequente ({{ heat_map.max_freq }})</span>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o 4: Sugest√µes de Jogos -->
        <div id="sugestoes" class="suggestions-section">
            <h2>üé≤ Sugest√µes de Jogos</h2>
            <p class="suggestions-subtitle">9 estrat√©gias diferentes baseadas em an√°lises estat√≠sticas</p>
            <div class="suggestions-grid">
                {% for sugestao in sugestoes %}
                <div class="suggestion-card">
                    <div class="suggestion-header">
                        <h3>{{ sugestao.estrategia }}</h3>
                        <p class="suggestion-desc">{{ sugestao.descricao }}</p>
                    </div>

                    <!-- Grade 5x5 -->
                    <div class="suggestion-cartela">
                        <div class="cartela-grid">
                            {% for i in range(1, 26) %}
                            <div class="cartela-cell {% if i in sugestao.numeros %}selected{% endif %}">
                                {{ i }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- N√∫meros em lista -->
                    <div class="suggestion-numbers">
                        {% for numero in sugestao.numeros %}
                        <span class="numero-badge-small">{{ numero }}</span>
                        {% endfor %}
                    </div>

                    <!-- Estat√≠sticas -->
                    <div class="concurso-stats">
                        <div class="stat-row">
                            <span class="stat-label">üîÑ Ciclo:</span>
                            <span class="stat-value">{{ sugestao.ciclo_count }}/15</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">‚öñÔ∏è P-I-NP:</span>
                            <span class="stat-value">{{ sugestao.config_pip }}</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">üî≤ Moldura:</span>
                            <span class="stat-value">{{ sugestao.moldura }}</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">‚¨õ Miolo:</span>
                            <span class="stat-value">{{ sugestao.miolo }}</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">üìä Linhas:</span>
                            <span class="stat-value">{{ sugestao.distribuicao_linhas }}</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">‚ó∞ Q1:</span>
                            <span class="stat-value">{{ sugestao.q1 }}</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">‚ó≥ Q2:</span>
                            <span class="stat-value">{{ sugestao.q2 }}</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">‚úü Cruz:</span>
                            <span class="stat-value">{{ sugestao.cruz }}</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">‚ó± Q3:</span>
                            <span class="stat-value">{{ sugestao.q3 }}</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">‚ó≤ Q4:</span>
                            <span class="stat-value">{{ sugestao.q4 }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <footer>
        <p>Desenvolvido para an√°lise da Lotof√°cil | Dados atualizados em tempo real</p>
    </footer>
</body>

</html>